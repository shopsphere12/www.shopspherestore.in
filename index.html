<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Maxed Out Group Chat</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg,#23272a,#2c2f33);
      color:#fff; display:flex; justify-content:center; align-items:center;
      height:100vh; overflow:hidden;
    }
    .container {
      background:#23272a; width:100%; max-width:1000px; height:95vh;
      border-radius:14px; display:flex; flex-direction:column;
      overflow:hidden; box-shadow:0 0 25px rgba(0,0,0,0.7);
      animation: fadeIn 1s ease-in-out;
    }
    @keyframes fadeIn { from{opacity:0;transform:scale(0.95);} to{opacity:1;transform:scale(1);} }

    .header {
      padding:16px; background:linear-gradient(90deg,#5865f2,#404eed);
      text-align:center; font-weight:bold; font-size:22px; letter-spacing:1px;
      box-shadow:0 2px 8px rgba(0,0,0,0.6);
    }

    .screen { flex:1; display:none; flex-direction:column; padding:20px; overflow-y:auto; }
    .active { display:flex; }

    input,button {
      padding:12px; margin:8px 0; border-radius:8px; border:none;
      font-size:15px; transition:0.3s ease;
    }
    input {
      width:100%; background:#40444b; color:#fff; outline:none;
    }
    input:focus { background:#36393f; border:1px solid #5865f2; }
    button {
      background:#5865f2; color:#fff; cursor:pointer; font-weight:bold;
    }
    button:hover { background:#4752c4; transform:scale(1.05); }

    /* Layout */
    .chatLayout { display:flex; flex:1; gap:12px; }
    .userList {
      width:200px; background:#202225; padding:10px; border-radius:8px;
      overflow-y:auto; animation: slideIn 0.5s ease;
    }
    @keyframes slideIn { from{transform:translateX(-20px);opacity:0;} to{transform:translateX(0);opacity:1;} }
    .user { padding:8px; margin-bottom:6px; border-radius:6px; background:#2c2f33; }
    .user.online { border-left:4px solid #43b581; }
    .user.offline { border-left:4px solid #f04747; }

    #messages { flex:1; overflow-y:auto; padding-right:8px; }
    .msg {
      margin-bottom:12px; padding:10px 14px; background:#40444b; border-radius:8px;
      animation: popIn 0.3s ease; position:relative;
    }
    @keyframes popIn { from{opacity:0;transform:translateY(10px) scale(0.95);} to{opacity:1;transform:translateY(0) scale(1);} }
    .msg.self { background:#5865f2; text-align:right; margin-left:auto; color:#fff; font-weight:bold; }
    .msg strong { color:#00aff4; }

    .seen { font-size:10px; position:absolute; bottom:2px; right:6px; color:#aaa; }

    .system { text-align:center; font-style:italic; font-size:13px; color:#bbb; margin:8px 0; }

    .typing { font-size:12px; color:#bbb; font-style:italic; margin-top:4px; }

    .input-area { display:flex; align-items:center; background:#202225; padding:12px; border-top:2px solid #18191c; }
    .input-area input { flex:1; margin-right:10px; }
    .emoji-picker { margin-right:8px; cursor:pointer; }

    @media(max-width:700px) {
      .chatLayout { flex-direction:column; }
      .userList { width:100%; height:100px; display:flex; flex-wrap:wrap; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">ðŸ’¬ Maxed Out Group Chat</div>

    <!-- Login -->
    <div id="loginScreen" class="screen active">
      <input id="username" placeholder="Your username">
      <input id="groupName" placeholder="Group name">
      <input id="groupPassword" type="password" placeholder="Group password">
      <button id="joinBtn">Join Group</button>
      <button id="createBtn">Create Group</button>
    </div>

    <!-- Chat -->
    <div id="chatScreen" class="screen">
      <div class="chatLayout">
        <div class="userList">
          <h4>ðŸ‘¥ Online Users</h4>
          <div id="userList"></div>
        </div>
        <div class="chatArea" style="flex:1;display:flex;flex-direction:column;">
          <div id="messages"></div>
          <div id="typingArea"></div>
          <div class="input-area">
            <span class="emoji-picker">ðŸ˜€</span>
            <input id="messageInput" placeholder="Type a message...">
            <button id="sendBtn">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Emoji Picker -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getDatabase, ref, push, set, get, child, onValue, onDisconnect, update } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    const firebaseConfig = {
     apiKey: "AIzaSyD0OAOSTic5z4U4obChkOieVLtvhgmIfxU",
    authDomain: "friend-chat-eaabe.firebaseapp.com",
    projectId: "friend-chat-eaabe",
    storageBucket: "friend-chat-eaabe.firebasestorage.app",
    messagingSenderId: "409498465855",
    appId: "1:409498465855:web:bfec1da1a2f29a1f73aa8a",
    measurementId: "G-DHE9SKBE8L"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const loginScreen=document.getElementById("loginScreen");
    const chatScreen=document.getElementById("chatScreen");
    const usernameInput=document.getElementById("username");
    const groupNameInput=document.getElementById("groupName");
    const groupPasswordInput=document.getElementById("groupPassword");
    const joinBtn=document.getElementById("joinBtn");
    const createBtn=document.getElementById("createBtn");
    const messagesDiv=document.getElementById("messages");
    const messageInput=document.getElementById("messageInput");
    const sendBtn=document.getElementById("sendBtn");
    const userList=document.getElementById("userList");
    const typingArea=document.getElementById("typingArea");
    const emojiBtn=document.querySelector(".emoji-picker");

    let currentGroup=null; let currentUser=null;

    async function createGroup(){
      const group=groupNameInput.value.trim();
      const password=groupPasswordInput.value.trim();
      if(!group||!password) return alert("Enter group & password!");
      await set(ref(db,"groups/"+group+"/password"),password);
      alert("Group created! Now join.");
    }

    async function joinGroup(){
      const group=groupNameInput.value.trim();
      const password=groupPasswordInput.value.trim();
      const name=usernameInput.value.trim();
      if(!group||!password||!name) return alert("Fill all fields!");
      const snapshot=await get(child(ref(db),"groups/"+group+"/password"));
      if(!snapshot.exists()) return alert("Group not found!");
      if(snapshot.val()!==password) return alert("Wrong password!");
      currentGroup=group; currentUser=name;

      // Mark online
      const userRef=ref(db,"groups/"+group+"/users/"+name);
      await set(userRef,{status:"online"});
      onDisconnect(userRef).set({status:"offline"});

      systemMessage(name+" joined the chat");

      loginScreen.classList.remove("active");
      chatScreen.classList.add("active");
      loadMessages(); loadUsers(); loadTyping();
    }

    function systemMessage(text){
      const sysRef=push(ref(db,"groups/"+currentGroup+"/messages"));
      set(sysRef,{name:"SYSTEM",text,time:new Date().toLocaleTimeString(),system:true});
    }

    function sendMessage(){
      if(!messageInput.value.trim()) return;
      push(ref(db,"groups/"+currentGroup+"/messages"),{
        name:currentUser,text:messageInput.value,time:new Date().toLocaleTimeString(),seenBy:{[currentUser]:true}
      });
      messageInput.value=""; stopTyping();
    }

    function loadMessages(){
      onValue(ref(db,"groups/"+currentGroup+"/messages"),snap=>{
        messagesDiv.innerHTML="";
        snap.forEach(child=>{
          const msg=child.val();
          const div=document.createElement("div");
          if(msg.system){ div.className="system"; div.textContent=msg.text; }
          else{
            div.className="msg"+(msg.name===currentUser?" self":"");
            div.innerHTML=`<strong>${msg.name}</strong>: ${msg.text}<div class="seen">âœ”âœ”</div>`;
          }
          messagesDiv.appendChild(div);
        });
        messagesDiv.scrollTop=messagesDiv.scrollHeight;
      });
    }

    function loadUsers(){
      onValue(ref(db,"groups/"+currentGroup+"/users"),snap=>{
        userList.innerHTML="";
        snap.forEach(child=>{
          const u=child.key; const val=child.val();
          const div=document.createElement("div");
          div.className="user "+(val.status==="online"?"online":"offline");
          div.textContent=u;
          userList.appendChild(div);
        });
      });
    }

    function startTyping(){
      set(ref(db,"groups/"+currentGroup+"/typing/"+currentUser),true);
    }
    function stopTyping(){
      set(ref(db,"groups/"+currentGroup+"/typing/"+currentUser),false);
    }
    function loadTyping(){
      onValue(ref(db,"groups/"+currentGroup+"/typing"),snap=>{
        typingArea.innerHTML="";
        snap.forEach(child=>{
          if(child.val()===true && child.key!==currentUser){
            const div=document.createElement("div");
            div.className="typing";
            div.textContent=child.key+" is typing...";
            typingArea.appendChild(div);
          }
        });
      });
    }

    // Events
    createBtn.addEventListener("click",createGroup);
    joinBtn.addEventListener("click",joinGroup);
    sendBtn.addEventListener("click",sendMessage);
    messageInput.addEventListener("keypress",e=>{
      if(e.key==="Enter") sendMessage();
      else startTyping();
    });
    messageInput.addEventListener("blur",stopTyping);

    // Emoji picker
    emojiBtn.addEventListener("click",()=>{
      const picker=document.createElement("emoji-picker");
      picker.style.position="absolute"; picker.style.bottom="70px"; picker.style.right="30px";
      picker.addEventListener("emoji-click",event=>{
        messageInput.value+=event.detail.unicode;
        picker.remove();
      });
      document.body.appendChild(picker);
    });
  </script>
</body>
</html>

